apiVersion: flox.dev/v1alpha1
kind: FloxEnvironment
metadata:
  name: keyhole
spec:
  manifest:
    version: 1
    install:
      age:
        pkg-path: age
      gnupg:
        pkg-path: gnupg
      keychain:
        pkg-path: keychain
      pass:
        pkg-path: pass
      sops:
        pkg-path: sops
      openssh:
        pkg-path: openssh
      openssl:
        pkg-path: openssl
      ssh-to-age:
        pkg-path: ssh-to-age
    profile:
      common: |
        if [[ -r $XDG_STATE_HOME/ssh-keys.d/github_signing ]]; then
          set -a
          SOPS_AGE_KEY="$( ssh-to-age -private-key < $XDG_STATE_HOME/ssh-keys.d/github_signing )"
          set +a
        fi
    options: {}
  env:
    name: keyhole
    version: 1
